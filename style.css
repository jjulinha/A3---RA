document.addEventListener('DOMContentLoaded', () => {
    const viewer = document.querySelector('#ar-viewer');
    const buttons = document.querySelectorAll('.model-btn');
    const description = document.getElementById('model-desc');
    
    // Elementos do Painel de Estatísticas
    const statPoly = document.getElementById('poly-count');
    const statVertex = document.getElementById('vertex-count');
    const statSize = document.getElementById('file-size');

    // Dados dos Modelos (Com viés acadêmico/técnico)
    const models = {
        robot: {
            src: 'https://modelviewer.dev/shared-assets/models/RobotExpressive.glb',
            iosSrc: 'https://modelviewer.dev/shared-assets/models/RobotExpressive.usdz',
            animation: 'Wave',
            desc: 'Robô Expressivo: Análise de malha deformável (Skinned Mesh). Demonstração de rigging hierárquico e interpolação de animação em tempo real.',
            stats: {
                poly: '~24.500',
                vert: '~12.200',
                size: '5.4 MB'
            }
        },
        astronaut: {
            src: 'https://modelviewer.dev/shared-assets/models/Astronaut.glb',
            iosSrc: 'https://modelviewer.dev/shared-assets/models/Astronaut.usdz',
            animation: 'Wave', 
            desc: 'Astronauta: Estudo de materiais reflexivos e oclusão de ambiente. Demonstra mapeamento UV complexo em superfícies curvas sem distorção.',
            stats: {
                poly: '~18.200',
                vert: '~9.100',
                size: '3.8 MB'
            }
        }
    };

    // Função de Troca de Modelo
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            // Atualiza botões
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Pega dados do modelo
            const modelKey = btn.getAttribute('data-model');
            const data = models[modelKey];

            // Atualiza o Visualizador 3D
            viewer.src = data.src;
            viewer.iosSrc = data.iosSrc;
            viewer.animationName = data.animation || null;

            // Efeito de Fade na descrição e Stats
            description.style.opacity = '0';
            
            setTimeout(() => {
                // Atualiza textos
                description.textContent = data.desc;
                statPoly.textContent = data.stats.poly;
                statVertex.textContent = data.stats.vert;
                statSize.textContent = data.stats.size;
                
                description.style.opacity = '1';
            }, 200);
        });
    });

    // Monitoramento de Status AR (Para Debug e Feedback)
    viewer.addEventListener('ar-status', (event) => {
        console.log('AR Status:', event.detail.status);
        
        if(event.detail.status === 'session-started'){
            // Feedback quando entra em AR
            console.log("Sessão iniciada: Buscando planos horizontais...");
        }
    });

    // Tratamento de Erros de Carregamento
    viewer.addEventListener('error', (error) => {
        console.error('Erro ao carregar modelo:', error);
        description.textContent = "Erro: Não foi possível carregar a malha 3D. Verifique a conexão.";
    });
});
